service cloud.firestore {
  match /databases/{database}/documents {
  	match /metadata/{dataType} {
    	allow get: if request.auth.uid != null;
    }

    match /ranking/{rankingId} {
    	match /list/{rankItemId} {
   		 	allow get: if request.auth.uid != null;
	    }
    }

    match /users/{userId} {
    	allow get, create, update: if matchOwnUserRef(request.resource.data.userRef);
    }

    match /highscores/{scoreId} {
			allow read
    }

    match /playlogs/{playlogId} {
    	allow create: if matchOwnUserRef(request.resource.data.userRef)
    }

    match /credentials/{credentialId} {
    	allow create, update: if matchOwnUserRef(request.resource.data.userRef)
    }

    function matchOwnUserRef(ref) {
  		return matchUserRef(ref, request.auth.uid);
		}

    function matchUserRef(ref, userId) {
			return ref != null && ref == get(/databases/$(database)/documents/users/$(userId)).__name__;
		}
  }
}
